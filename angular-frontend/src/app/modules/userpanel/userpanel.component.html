<div class="flex flex-col min-[1000px]:flex-row p-4 gap-6 w-full pt-28">

 <!-- Calendario -->
  <div
    class="w-full min-[1000px]:w-[400px] max-h-[500px] bg-[#79CDC7] rounded-xl p-4 shadow-md"
  >
    <app-calendar
      [days]="days"
      [closedDays]="closedDays"
      [userBookingDays]="userBookingDays"
      (daySelected)="selectDay($event)"
      (monthChanged)="onMonthChanged($event)">
    </app-calendar>
    <!-- Leyenda -->
    <div class="mt-4 text-xs min-[1000px]:text-sm text-stone-800">
      <p class="font-semibold mb-2">Leyenda:</p>

      <div class="flex items-center gap-2 mb-1">
        <span class="w-4 h-4 rounded-sm bg-green-500"></span>
        <span>Libre</span>
      </div>

      <div class="flex items-center gap-2 mb-1">
        <span class="w-4 h-4 rounded-sm bg-green-300"></span>
        <span>Parcialmente Libre</span>
      </div>

      <div class="flex items-center gap-2 mb-1">
        <span class="w-4 h-4 rounded-sm bg-yellow-500"></span>
        <span>Parcialmente Completo</span>
      </div>

      <div class="flex items-center gap-2 mb-1">
        <span class="w-4 h-4 rounded-sm bg-red-500"></span>
        <span>Completo</span>
      </div>

      <div class="flex items-center gap-2 mb-1">
        <span class="w-4 h-4 rounded-sm bg-blue-500"></span>
        <span>Día con reservas propias</span>
      </div>

      <div class="flex items-center gap-2 mb-1">
        <span class="w-4 h-4 rounded-sm bg-black"></span>
        <span>Día cerrado</span>
      </div>
    </div>
  </div>

   <!-- Timeslots -->
  <div class="flex-1 w-full min-[1000px]:min-w-[600px] bg-[#79CDC7] rounded-xl p-4 shadow-md">
    
    <h2 class="text-base min-[1000px]:text-xl font-bold mb-2" *ngIf="selectedDate">
      Reservas del {{ formatTitleDate(selectedDate) }}
    </h2>

    <div *ngIf="!selectedDate"
         class="text-gray-500 font-bold text-center pb-3 text-sm min-[1000px]:text-base">
      Selecciona un día para ver las reservas
    </div>

    <div class="space-y-2 overflow-y-auto pr-2"
       style="max-height: calc(80vh - 220px);">

      <!-- Tarjeta por cada timeslot -->
      <div *ngFor="let slot of timeslots"
           class="bg-white border p-4 rounded shadow flex items-center justify-between relative h-24 w-full text-sm min-[1000px]:text-base ">

        <div class="font-semibold w-1/3">

          <!-- Vista para móviles -->
          <span class="block md:hidden leading-tight">
            {{ slot.start_time }} -<br>
            {{ slot.end_time }}
          </span>

          <!-- Vista para escritorio -->
          <span class="hidden md:block whitespace-nowrap">
            {{ selectedDate ? (slot.start_time + ' - ' + slot.end_time) : '' }}
          </span>

        </div>

        <div class="absolute inset-0 flex items-center justify-center">
          <ng-container *ngIf="selectedDate">
            <ng-container *ngIf="getBookingForTimeslot(slot) as booking; else freeSlot">

              <!-- Reservas del Usuario -->
              <span *ngIf="booking.student_id === studentId; else otherBooking" 
                    class="flex flex-col
                          text-blue-600 font-bold
                          text-sm min-[1000px]:text-base">
                Tu reserva: {{ booking.subject}}
              </span>

              <!-- Reservas de otros Usuarios -->
              <ng-template #otherBooking>
                <span class="text-red-600 font-bold text-sm min-[1000px]:text-base">
                  Reservado
                </span>
              </ng-template>
            </ng-container>

            <!-- Si el slot está libre -->
            <ng-template #freeSlot>
              <!-- Crear reserva -->
              <span *ngIf="selectedSlot !== slot" 
                    class="text-green-600 font-bold cursor-pointer text-sm min-[1000px]:text-base" 
                    (click)="selectSlot(slot)">
                Libre
              </span>

              <div *ngIf="selectedSlot === slot" class="flex flex-col min-[1000px]:flex-row items-center gap-2 pr-12 min-[1000px]:gap-4 pl-20">
                <select class="border rounded px-2 py-1 text-sm min-[1000px]:text-base"
                        [(ngModel)]="selectedSubjectId">
                  <option [ngValue]="null">-- Asignatura --</option>
                  <option *ngFor="let subj of userSubjects" [ngValue]="subj.id">{{ subj.name }}</option>
                </select>
                <button (click)="cancelSlotSelection()" 
                        class="absolute right-2 top-1/2 transform -translate-y-1/2 px-2 py-1 bg-gray-200 rounded hover:bg-gray-300">
                  X
                </button>
              </div>
            </ng-template>
          </ng-container>
        </div>
      </div>
    </div>
    <div class="mt-4 flex justify-center" *ngIf="selectedSlot">
      <span
        *ngIf="selectedSlot && !selectedSubjectId"
        class="text-stone-600 text-center text-sm md:text-base"
      >
        Selecciona la asignatura para crear la reserva
      </span>
      <button 
              *ngIf="selectedSubjectId"
              (click)="makeBooking()" 
              [disabled]="!slotSelected" 
              class="px-4 py-2 bg-green-600 text-black rounded hover:bg-green-400 disabled:bg-gray-400 disabled:hover:cursor-not-allowed">
        Reservar
      </button>
    </div>
  </div>
</div>