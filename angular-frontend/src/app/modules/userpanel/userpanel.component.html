<div class="flex p-4 gap-12 w-full pt-28">

  <!-- Calendario reutilizable -->
  <div class="w-1/3">
    <app-calendar
      [days]="days"
      [closedDays]="closedDays"
      (daySelected)="selectDay($event)"
      (monthChanged)="onMonthChanged($event)">
    </app-calendar>
  </div>

  <!-- Franjas horarias / tarjetas -->
  <div class="w-2/3">
    <h2 class="text-xl font-bold mb-2" *ngIf="selectedDate">
      Reservas del {{ selectedDate }}
    </h2>

    <div *ngIf="!selectedDate" class="text-gray-500 font-bold text-center pb-3">
      Selecciona un d√≠a para ver las reservas
    </div>

    <div class="space-y-2 ">
      <div *ngFor="let slot of timeslots" 
          class="border p-3 rounded shadow flex items-center justify-between relative h-20">
        <div class="font-semibold w-1/3">
          {{ selectedDate ? (slot.start_time + ' - ' + slot.end_time) : '' }}
        </div>

        <div class="absolute inset-0 flex items-center justify-center">
          <ng-container *ngIf="selectedDate">
            <ng-container *ngIf="getBookingForTimeslot(slot) as booking; else freeSlot">
              <span *ngIf="booking.student_id === studentId; else otherBooking" class="text-blue-600 font-bold">
                Tu reserva: {{ booking.subject}}
              </span>
              <ng-template #otherBooking>
                <span class="text-red-600 font-bold">
                  Reservado
                </span>
              </ng-template>
            </ng-container>

            <ng-template #freeSlot>
              <span *ngIf="selectedSlot !== slot" 
                    class="text-green-600 font-bold cursor-pointer" 
                    (click)="selectSlot(slot)">
                Libre
              </span>

              <div *ngIf="selectedSlot === slot" class="flex items-center gap-2 px-6">
                <select class="border rounded px-1 py-0.5 mr-4"
                        [(ngModel)]="selectedSubjectId">
                  <option [ngValue]="null">-- Asignatura --</option>
                  <option *ngFor="let subj of userSubjects" [ngValue]="subj.id">{{ subj.name }}</option>
                </select>
                <button (click)="cancelSlotSelection()" 
                        class="absolute right-2 top-1/2 transform -translate-y-1/2 px-2 py-1 bg-gray-200 rounded hover:bg-gray-300">
                  X
                </button>
              </div>
            </ng-template>
          </ng-container>
        </div>
      </div>
    </div>
    <div class="mt-4 flex justify-center" *ngIf="selectedSlot">
      <button (click)="makeBooking()" 
              [disabled]="!slotSelected" 
              class="px-4 py-2 bg-green-600 text-black rounded hover:bg-green-400 disabled:bg-gray-400 disabled:hover:cursor-not-allowed">
        Reservar
      </button>
    </div>
  </div>
</div>